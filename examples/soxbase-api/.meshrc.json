{
  "$schema": "https://raw.githubusercontent.com/Urigo/graphql-mesh/master/packages/types/src/config-schema.json",
  "sources": [
    {
      "name": "GraphCMS",
      "handler": {
        "graphql": {
          "endpoint": "${GRAPHCMS_URL}",
          "operationHeaders": {
            "Authorization": "${GRAPHCMS_BEARER}"
          },
          "schemaHeaders": {
            "Authorization": "${GRAPHCMS_BEARER}"
          },
          "cacheIntrospection": true
        }
      },
      "transforms": [
        {
          "filterSchema": ["Query.pages"]
        }
      ]
    },
    {
      "name": "Magento GraphQL",
      "handler": {
        "graphql": {
          "endpoint": "${MAGENTO_ENDPOINT}",
          "useGETForQueries": true,
          "cacheIntrospection": true,
          "schemaHeaders": {
            "Store": "{context.req.headers.store}",
            "Authorization": "{context.req.headers.authorization}"
          },
          "operationHeaders": {
            "Store": "{context.req.headers.store}",
            "Authorization": "{context.req.headers.authorization}"
          }
        }
      },
      "transforms": [
        {
          "cache": [
            {
              "field": "Query.storeConfig",
              "invalidate": { "ttl": 300 }
            }
          ]
        }
      ]
    }
  ]
}
