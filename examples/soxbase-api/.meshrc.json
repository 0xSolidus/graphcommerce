{
  "$schema": "../../node_modules/@graphql-mesh/types/config-schema.json",
  "sources": [
    {
      "name": "graphcms",
      "handler": {
        "graphql": {
          "endpoint": "${GRAPHCMS_URL}",
          "operationHeaders": {
            "Authorization": "${GRAPHCMS_BEARER}"
          },
          "schemaHeaders": {
            "Authorization": "${GRAPHCMS_BEARER}"
          },
          "cacheIntrospection": true
        }
      },
      "transforms": [
        {
          "filterSchema": ["Query.{pages,footer}", "Mutation.none"]
        }
      ]
    },
    {
      "name": "m2",
      "handler": {
        "graphql": {
          "endpoint": "${MAGENTO_ENDPOINT}",
          "useGETForQueries": true,
          "cacheIntrospection": true,
          "schemaHeaders": {
            "Store": "{context.req.headers.store}",
            "Authorization": "{context.req.headers.authorization}"
          },
          "operationHeaders": {
            "Store": "{context.req.headers.store}",
            "Authorization": "{context.req.headers.authorization}"
          }
        }
      },
      "transforms": [
        {
          "cache": [
            {
              "field": "Query.storeConfig",
              "invalidate": { "ttl": 300 }
            }
          ]
        }
      ]
    }
  ],
  "additionalTypeDefs": "extend type MagentoCategory { category: CategoryTree }",
  "additionalResolvers": [
    {
      "type": "MagentoCategory",
      "field": "category",
      "requiredSelectionSet": "{ url }",
      "targetSource": "m2",
      "targetMethod": "categories",
      "args": { "filters.url_path.eq": "{root.url}", "pageSize": "1" },
      "returnData": "items[0]",
      "resultDepth": 4
    }
  ]
}
